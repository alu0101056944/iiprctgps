## Interfaces Multimodales. Brújula, Acelerómetro y GPS

Marcos Barrios

alu0101056944

*PC version gif demo*

![Demo](assets/demo.gif)


### Trabajo realizado

Se agregaron cubos para formar una sala que hace de interior de un edificio en donde la interacción toma lugar. Se agregaron más cubos para formar cuatro ventanas, a las cuales se les asigno un material de cristal obtenido del paquete [Ice shader](https://assetstore.unity.com/packages/vfx/shaders/ice-shader-tutorial-91432). A continuación se cambió la iluminación de la escena a un color sólido y oscuro para evitar excesos en reflexiones y se introdujeron puntos de iluminación naranjas junto a modelos de [Lámparas 3D](https://assetstore.unity.com/packages/p/free-pbr-lamps-70181) a modo de decoración en las paredes. Se asignó un [SkyBox](https://docs.unity3d.com/es/530/Manual/class-Skybox.html) descargado de la Asset Store; [Customizable Skybox](https://assetstore.unity.com/packages/p/customizable-skybox-174576) y un [CubeMap](https://docs.unity3d.com/Manual/class-Cubemap.html) para la iluminación de los reflejos. Para finalizar la creación de la escena se descargaron texturas de madera para asignarlas a las paredes del interior.

Para la versión de ordenador de la escena se agregó un [controlador en 3D en primera persona](https://assetstore.unity.com/packages/p/modular-first-person-controller-189884). Se modificó agregándo un objeto vacío llamado <code>RaycastOrigin</code> para poder visualizar la dirección del Raycast que proviene del centro de la cámara. Un script [PlayerRaycast.cs](PlayerRaycast.cs) es componente de dicho objeto y contiene un evento que es ejecutado cada vez que el Raycast colisiona con otro [Collider](https://docs.unity3d.com/ScriptReference/Collider.html).

A continuación se programó el script [BowlingBallThrower.cs](src/BowlingBallThrower.cs), que se asigna a un [GameObject](https://docs.unity3d.com/ScriptReference/GameObject.html) y permite impulsar físicamente instancias de otro <code>GameObject</code> asignado al script mediante el editor a partir de la posición del <code>GameObject</code> que tiene asignado el script, cada varios segundos. El objetivo ha sido diseñar la escena de forma que contenga una zona de lanzadores de bolas que el jugador deberá esquivar utilizando el acelerómetro como método de movimiento paralelo a los lanzadores, en su versión Android. En la versión de ordenador se utiliza el teclado y el ratón. Un objeto hijo es utilizado para obtener la dirección de lanzamiento. También se utiliza la función <code>Random.Range()</code> para obtener un decimal que es comparado con una probabilidad tal que si es menor que dicha probabilidad instancia y lanza la bola. Se definió una variable para el tiempo mínimo entre lanzamiento.

Se creó un objeto vacío dentro del interior que contiene un [BoxCollider](https://docs.unity3d.com/es/2018.4/Manual/class-BoxCollider.html) en modo <code>isTrigger = true</code> para destruir todas las bolas que entran en su contacto. Es utilizado para que las bolas que no hayan alcanzado al jugador desaparezcan. Se le asignó el script [GameObjectDestroyOnTouch.cs](src/GameObjectDestroyOnTouch.cs), que contiene una funcion <code>OnTriggerEnter()</code> que destruye el objeto que toca siempre y cuando su etiqueta sea <code>"BowlingBall"</code>.

El objetivo del juego es sobrevivir el máximo tiempo posible. Es por ello que se introdujo un script [CounterOfSurvivalTime.cs](src/CounterOfSurvivalTime.cs) que mantiene una variable a modo de contador decimal incrementado en el método <code>Update()</code> para obtener los segundos totales de ejecución. Su valor se muestra en un <code>Label</code> posicionado en la esquina superior izquierda de la pantalla.

Cuando el jugador toca una pelota pierde el juego. Cuando se pierde aparece información en pantalla que indica al usuario que presione la pantalla para reintentar la escena. Para implementarlo se agregó un script al objeto <code>GlobalScripts</code>, que contiene la etiqueta <code>GlobalScripts</code> para su acceso desde scripts. Se trata de [GameOver.cs](src/GameOver.cs) y contiene dos métodos públicos; uno para activar el gameover y otro para recargar la escena. Incluye un método <code>OnGui()</code> que renderiza etiquetas con la información necesaria y otro método <code>Update()</code> para poder reconocer la interacción del usuario que permite recargar la escena. Se utiliza la variable <code>Time.scaleTime</code> para parar el paso del tiempo en el juego.

Para activar el modo GameOver se introdujo un script [GameOverOnPlayerTouch.cs](src/GameOverOnPlayerTouch.cs) que obtiene una referencia al script de [GameOver.cs](src/GameOver.cs) y lo activa cuando el jugador toca el <code>GameObject</code> que tiene asignado el script. El objetivo es que cuando el jugador toque la esfera se produzca el GameOver, por ello se asigno el script al [Prefab](https://docs.unity3d.com/es/530/Manual/Prefabs.html) de la pelota, el cual es instanciado en la escena por los lanzadores.

Se introdujo un objeto esférico 3D al que se llamó <code>LookAtCheck</code> para incrementar la dificultad de la supervivencia del juego. Cada cierto tiempo se activan y el jugador debe mirarlos directamente con la retícula para desactivarlos. Cambian de color según se activan o desactivan. Cuando no se desactivan a tiempo es GameOver. Para su implementación se les agregó un script [LookAtCheckLogic.cs](src/LookAtCheckLogic.cs), que se suscribe al evento de Raycast del jugador y mantiene una variable para su estado de activación. Mantiene otras variables como el tiempo entre activación y los segundos tras los cuales sucede GameOver si el jugador no mira el <code>GameObject</code>. Hay un objeto al fondo de la sala y otro a la izquierda para forzar al jugador a dejar de mirar a los bolos que vienen en su dirección durante un breve lapso de tiempo.

Por último se creó un script global agregado al <code>GameObject</code> GlobalScripts que obtiene los valores de latitud, longitud y altitud del servicio de GPS y modifica las propiedades del material del <code>Skybox</code> acorde a ellos. Según la localización del jugador el <code>Skybox</code> tendrá distintas tonalidades.

Se creó un script llamado [InitiateLocationServices.cs](src/InitiateLocationServices.cs) para inicial el servicio de localización nada más ejecutar el juego. Para ello se agregó al <code>GameObject</code> GlobalScripts. Si no se inician los servicios se mantiene el juego en pausa. Se dibujan etiquetas para informar si se está esperando todavia por el servicio o si ha ocurrido algún problema.

Para el control del juego en el móvil a través del acelerómetro y la brújula primero se eliminó el controlador en primera persona y se sustituyo por otro que permite modificar los scripts de movimiento. Un script [FirstPersonMovement.cs](src/FirstPersonMovement.cs) se encarga de limitar el movimiento para que sea paralelo a los lanzadores de pelotas. Se restringe el movimiento en el eje x, el cual controla la cercania a los lanzadores, dejando el eje z para el movimiento paralelo a los mismos. Otro script [FirstPersonLook.cs](src/FirstPersonLook.cs) permite al jugador rotar la cámara.
